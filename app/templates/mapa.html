<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa del Clima con OpenWeatherMap y MapboxGL</title>
    
    <!-- Incluir MapboxGL CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
    
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .map-overlay {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            z-index: 1;
        }
        .layer-selection {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 4px;
            z-index: 1;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        select {
            padding: 5px;
            width: 200px;
        }
    </style>
</head>
<body>
    <!-- Contenedor del mapa -->
    <div id="map"></div>
    
    <!-- Selector de capas -->
    <div class="layer-selection">
        <h3>Selecciona capa meteorológica:</h3>
        <select id="layer-select">
            <option value="temp_new">Temperatura</option>
            <option value="precipitation_new">Precipitación</option>
            <option value="clouds_new">Nubes</option>
            <option value="pressure_new">Presión</option>
            <option value="wind_new">Viento</option>
        </select>
    </div>
    
    <!-- Incluir MapboxGL JS -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    
    <script>
        // Configura tus claves de API
        const mapboxToken = 'pk.eyJ1IjoiY2hyaXN0aWFuMDYwNSIsImEiOiJjbTgyNGwxcHQwcHd1MmtwaXFwM3d0bmJ0In0.0jfyr1BQLId2NjsfVX_jjg';
        const owmApiKey = '2ada891d90a3ccdef40af5952a1e6bb0';
        
        // Variable para almacenar la capa actual
        let currentLayer = 'temp_new';
        
        // Inicializa el mapa
        mapboxgl.accessToken = mapboxToken;
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-106.077, 28.636], // Ciudad de México por defecto
            zoom: 10
        });
        
        // Función para añadir capa meteorológica
        function addWeatherLayer(layerType) {
            // Eliminar capa anterior si existe
            if (map.getSource('openweathermap')) {
                map.removeLayer('openweathermap-layer');
                map.removeSource('openweathermap');
            }
            
            // Añadir nueva capa
            map.addSource('openweathermap', {
                'type': 'raster',
                'tiles': [
                    `https://tile.openweathermap.org/map/${layerType}/{z}/{x}/{y}.png?appid=${owmApiKey}`
                ],
                'tileSize': 256,
                'attribution': '© OpenWeatherMap'
            });
            
            map.addLayer({
                'id': 'openweathermap-layer',
                'type': 'raster',
                'source': 'openweathermap',
                'paint': {
                    'raster-opacity': 0.8
                }
            });
        }
        
        // Cuando el mapa cargue
        map.on('load', function() {
            // Agregar capa inicial (temperatura)
            addWeatherLayer(currentLayer);
            
            // Detectar cambios en el selector de capas
            document.getElementById('layer-select').addEventListener('change', function(e) {
                currentLayer = e.target.value;
                addWeatherLayer(currentLayer);
            });
        });
        
        // Agregar controles de navegación
        map.addControl(new mapboxgl.NavigationControl());
        
        // Agregar control de geolocalización
        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true,
            showUserHeading: true
        }));
        
        // Intentar geolocalizar al usuario al cargar
        map.on('load', () => {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    map.flyTo({
                        center: [position.coords.longitude, position.coords.latitude],
                        zoom: 8
                    });
                },
                (error) => {
                    console.log('Error obteniendo la geolocalización:', error);
                }
            );
        });
    </script>
</body>
</html>